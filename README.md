# Persistent-memory-Neko
RAG (Retrieval-Augmented Generation) 对话系统实现
"""
RAG (Retrieval-Augmented Generation) 对话系统实现
====================================

系统架构
--------
本系统实现了一个基于 RAG (检索增强生成) 的对话系统，集成了以下核心组件：

1. 向量数据库 (FAISS)
   - 用于存储对话的向量表示
   - 支持高效的相似度检索
   - 使用 L2 距离进行相似度计算
   - 自动处理数据格式兼容性

2. 图数据库 (Neo4j)
   - 存储结构化的对话历史
   - 支持时间序列查询
   - 使用标签和索引优化查询性能

3. 大语言模型 (Qwen)
   - 通过 SiliconFlow API 访问
   - 支持流式输出
   - 集成上下文增强的对话能力

4. 向量嵌入 (BGE-Large)
   - 使用 BAAI/bge-large-zh-v1.5 模型
   - 1024 维向量表示
   - 通过 SiliconFlow API 获取嵌入

工作流程
--------
1. 用户输入处理
   - 接收用户输入
   - 生成输入文本的向量表示

2. 上下文检索
   - 基于向量相似度搜索相关历史对话
   - 获取最近的对话记录
   - 组合生成增强上下文

3. 响应生成
   - 将上下文注入到系统提示中
   - 调用语言模型生成回答
   - 流式输出响应内容

4. 记忆存储
   - 将对话保存到 Neo4j
   - 生成对话的向量表示
   - 更新 FAISS 索引

关键类说明
--------
1. Memory
   - 对话记忆的数据结构
   - 包含用户消息、AI响应、时间戳和相似度
   - 支持格式化输出

2. Neo4jDatabase
   - 处理与 Neo4j 的交互
   - 管理数据库结构和索引
   - 提供记忆的 CRUD 操作

3. FAISSMemoryStore
   - 管理向量索引和检索
   - 处理数据持久化
   - 提供相似度搜索功能

性能优化
--------
1. 向量检索
   - 使用 FAISS 的 L2 距离索引
   - 支持高效的 K 近邻搜索

2. 数据库优化
   - 时间戳索引加速查询
   - 批量操作减少数据库负载

3. 内存管理
   - 流式处理大型响应
   - 优化数据结构减少内存占用

使用说明
--------
1. 环境要求
   - Python 3.8+
   - Neo4j 数据库
   - FAISS CPU 版本
   - OpenAI API 密钥

2. 配置说明
   - Neo4j 连接参数
   - API 密钥设置
   - 向量维度配置

3. 运行方式
   - 直接对话模式
   - 支持退出命令
   - 自动保存对话历史
"""